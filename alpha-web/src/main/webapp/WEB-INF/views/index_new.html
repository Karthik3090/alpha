<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
	<link rel="manifest" href="manifest.json">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<!--Let browser know website is optimized for mobile-->
   <meta name="viewport" content='width=device-width, initial-scale=1.0, user-scalable=0'/>
    <meta name="description" content="">
    <meta name="author" content="UMAR ABBAS, text.umarabbas@gmail.com">
	<title>Alpha - Energon</title>
	<!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="static/css/materialize.min.css"  media="screen,projection"/>
    <link rel="stylesheet" href="static/css/font-awesome.min.css"  media="screen,projection"/>
	<link rel="stylesheet" href="static/css/style.css"  media="screen,projection"/>
	 <meta name="apple-mobile-web-app-title" content="Alpha - Energon">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="mobile-web-app-capable" content="yes">
        <link rel="apple-touch-icon" type="image/png" href="static/img/icon175x175.png" sizes="192x192">
        <link rel="apple-touch-icon" type="image/png" href="static/img/icon175x175.png" sizes="160x160">
        <link rel="apple-touch-icon" type="image/png" href="static/img/icon175x175.png" sizes="96x96">
        <link rel="apple-touch-icon" type="image/png" href="static/img/icon175x175.png" sizes="16x16">
        <link rel="apple-touch-icon" type="image/png" href="static/img/icon175x175.png" sizes="32x32">
		<link rel="icon" sizes="192x192" href="static/img/icon175x175.png"> 
		<link rel="icon" sizes="128x128" href="static/img/icon175x175.png">
		<link rel="apple-touch-icon-precomposed" sizes="128x128" href="static/img/icon175x175.png">
</head>
<body>
	<!-- Template Start here -->
	<div id="outerwrap">
	<!--Head Layout -->
	<div id="header">
		<Header>
		  <div class="navbar-fixed">
		  <nav>
		  <div class="nav-wrapper">
			<a href="#!" class="brand-logo">Energon</a>
			
			 <ul id="slide-out" class="side-nav">
			<li><div class="userView">
			<div class="background">
			<img src="static/img/office.jpg">
			</div>
		<a href="#!user"><img class="circle" src="static/img/umar.jpg"></a>
		 <br/>
		<a href="#!name"><span class="white-text name">Umar Abbas</span></a>
      <a href="#!email"><span class="white-text email">text.umarabbs@gmail.com</span></a>
    </div></li>
    <li><a href="#!"><i class="fa fa-car" aria-hidden="true"></i>First Link With Icon</a></li>
    <li><a href="#!">Second Link</a></li>
    <li><div class="divider"></div></li>
    <li><a class="subheader">Subheader</a></li>
    <li><a class="waves-effect" href="#!">Third Link With Waves</a></li>
  </ul>
  <a href="#" data-activates="slide-out" class="button-collapse"><i class="material-icons" style="color:#d4d4d4">menu</i></a>
			</div>
			</nav>
		  </div> <!-- Class navbar-fixed end here -->
		</Header>
	</div><!-- #header Ends Here --> 
	<!--Head Layout End -->
	<main>
	<!-- Page Content Start Here -->
	  <div class="row">
        <!-- <div class="col s12 m6">
        <div id="headMap"><div id="map"></div></div> for loading of map
          <div class="card blue-grey darken-1">
            <div class="card-content white-text">
              <span class="card-title">Card Title</span>
              <p>I am a very simple card. I am good at containing small bits of information.
              I am convenient because I require little markup to use effectively.</p>
            </div>
            <div class="card-action">
              <a href="#">This is a link</a> Check when during making on-click 
              <a href="#">This is a link</a>
            </div>
          </div>
        </div> -->
        
        <div id="chargingDetails" class="col s12 m6">
          <div class="card blue-grey darken-1 card-content white-text">
	            <ul>
	            	<li><b>Station Name</b> 	: P30V1</li>
	            	<li><b>Charging Point</b>	: PSLV </li>
	            	<li><b>Free</b>				: 2 </li>
	            	<li><b>Occupied</b>			: 3</li>
	            </ul>
           </div>
           <div class="card blue-grey darken-1 card-content white-text">
	            <ul>
	            	<li><b>Station Name</b> 	: P40V1</li>
	            	<li><b>Charging Point</b>	: UTDY </li>
	            	<li><b>Free</b>				: 1 </li>
	            	<li><b>Occupied</b>			: 4</li>
	            </ul>
            </div>
            <div class="card blue-grey darken-1 card-content white-text">
	            <ul>
	            	<li><b>Station Name</b> 	: P33V2</li>
	            	<li><b>Charging Point</b>	: UMAR </li>
	            	<li><b>Free</b>				: 0 </li>
	            	<li><b>Occupied</b>			: 8</li>
	            </ul>
            </div>
            <div class="card blue-grey darken-1 card-content white-text">
	            <ul>
	            	<li><b>Station Name</b> 	: P43V3</li>
	            	<li><b>Charging Point</b>	: VEER </li>
	            	<li><b>Free</b>				: 1 </li>
	            	<li><b>Occupied</b>			: 6</li>
	            </ul>
            </div>
          </div>
        </div>
      </div>
            
	<!-- Page Content End  Here -->
	</main>
	<!-- Footer -->
	<div id="footer">
		  <footer>
		    <div class="row">
			<div class="col s1">
			<i class="fa fa-map-marker fa-2x" aria-hidden="true" ></i><br/>
			Current Location
			</div>
			
			<div class="col s1">
			<i class="fa fa-search fa-2x" aria-hidden="true"></i><br/>
			Search
			</div>
			
			<div class="col s1">
			<span class="badge1" data-badge="6"><i class="fa fa-bell fa-2x badge1" aria-hidden="true" ></i></span><br/>
			Notification
			</div>
			
			<div class="col s1">
			<i class="fa fa-user fa-2x" aria-hidden="true"></i> <br/>
			Me
			</div>
			
			</div>
			 </footer>
          </div> <!-- Footer Ends Here --> 
      
	</div> <!-- #outerwrap ends here --> 
	
	<!-- Template End here -->
	<!--Import jQuery before materialize.js-->
    <script type="text/javascript" src="static/js/jquery.js"></script>
    <script type="text/javascript" src="static/js/materialize.min.js"></script>
	<script type="text/javascript">
	var state = 0;
	$( document ).ready(function(){
	$(".button-collapse").sideNav();
	
	});
	</script>
	
	<script>
    
    window.RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;   //compatibility for firefox and chrome
    var pc = new RTCPeerConnection({iceServers:[]}), noop = function(){};      
    pc.createDataChannel("");    //create a bogus data channel
    pc.createOffer(pc.setLocalDescription.bind(pc), noop);    // create offer and set local description
    pc.onicecandidate = function(ice){  //listen for candidate events
        if(!ice || !ice.candidate || !ice.candidate.candidate)  return;
        window.myIP = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate)[1];
       
        pc.onicecandidate = noop;
    };
    
    var map_icon = 'static/img/Car_50.png';
	  var all_markers= [];
      
       function auto_update(){
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
        	  
        	  for(i=0; i<all_markers.length;++i){
        		  all_markers[i].setMap(null);
        	  }
        	  
              var pos = {
                      lat: position.coords.latitude,
                      lng: position.coords.longitude
                    };
                    
            map.setCenter(pos);
           
      	   $.ajax({
     		   url: "api/driver/saveDetails",
     		   data: {
     			   my_ip: myIP,
     			   lat : pos.lat,
     			   lng : pos.lng
     		   }
     		 });
                 
      	   
    	   $.ajax({
     		   url: "api/findAll",
     		   success: function(others_pos) {
     	            for(i=0;i < others_pos.length; ++i){
     	                var marker = new google.maps.Marker({
     	                    position: {lat:parseFloat(others_pos[i].lat), lng:parseFloat(others_pos[i].lng)},
     	                    map: map,
     	                    icon : map_icon
     	                  });	
     	                
     	                all_markers.push(marker);
     	            }
     		   }
     	      });
            
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        }
      }
       
       function initMap() {
    	   window.map = new google.maps.Map(document.getElementById('map'), {
               center: {lat: 52.3105419, lng: 4.7660857},
               zoom: 20,
               mapTypeControlOptions: {
            	      mapTypeIds: []
            	    },
               mapTypeId: google.maps.MapTypeId.ROADMAP,
               styles: [
                        {elementType: 'geometry', stylers: [{color: '#242f3e'}]},
                        {elementType: 'labels.text.stroke', stylers: [{color: '#242f3e'}]},
                        {elementType: 'labels.text.fill', stylers: [{color: '#746855'}]},
                        {
                          featureType: 'administrative.locality',
                          elementType: 'labels.text.fill',
                          stylers: [{color: '#d59563'}]
                        },
                        {
                          featureType: 'poi',
                          elementType: 'labels.text.fill',
                          stylers: [{color: '#d59563'}]
                        },
                        {
                          featureType: 'poi.park',
                          elementType: 'geometry',
                          stylers: [{color: '#263c3f'}]
                        },
                        {
                          featureType: 'poi.park',
                          elementType: 'labels.text.fill',
                          stylers: [{color: '#6b9a76'}]
                        },
                        {
                          featureType: 'road',
                          elementType: 'geometry',
                          stylers: [{color: '#38414e'}]
                        },
                        {
                          featureType: 'road',
                          elementType: 'geometry.stroke',
                          stylers: [{color: '#212a37'}]
                        },
                        {
                          featureType: 'road',
                          elementType: 'labels.text.fill',
                          stylers: [{color: '#9ca5b3'}]
                        },
                        {
                          featureType: 'road.highway',
                          elementType: 'geometry',
                          stylers: [{color: '#746855'}]
                        },
                        {
                          featureType: 'road.highway',
                          elementType: 'geometry.stroke',
                          stylers: [{color: '#1f2835'}]
                        },
                        {
                          featureType: 'road.highway',
                          elementType: 'labels.text.fill',
                          stylers: [{color: '#f3d19c'}]
                        },
                        {
                          featureType: 'transit',
                          elementType: 'geometry',
                          stylers: [{color: '#2f3948'}]
                        },
                        {
                          featureType: 'transit.station',
                          elementType: 'labels.text.fill',
                          stylers: [{color: '#d59563'}]
                        },
                        {
                          featureType: 'water',
                          elementType: 'geometry',
                          stylers: [{color: '#17263c'}]
                        },
                        {
                          featureType: 'water',
                          elementType: 'labels.text.fill',
                          stylers: [{color: '#515c6d'}]
                        },
                        {
                          featureType: 'water',
                          elementType: 'labels.text.stroke',
                          stylers: [{color: '#17263c'}]
                        }
                      ]
             });
    	   setInterval(auto_update, 5000);
       }

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBEJ4eLPCqz-8LDVW8GXWnvuky8ZjxH52M&callback=initMap">
    </script>
</body>
</html>